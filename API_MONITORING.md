# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

## –°–ø–æ—Å–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏

### 1. –ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

**URL:** `https://conversor.onza.me/admin/api_monitor.php`

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è (–∑–∞–ø—Ä–æ—Å—ã, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, IP, endpoints)
- –¢–æ–ø –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö endpoints
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º (iOS, Android)
- –ê–∫—Ç–∏–≤–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
1. –í–æ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: `https://conversor.onza.me/admin/`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "üì° –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ API"
3. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –∏–∑ –¥–∞—à–±–æ—Ä–¥–∞

### 2. –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É (–°–∫—Ä–∏–ø—Ç)

**–°–∫—Ä–∏–ø—Ç:** `./scripts/check_api_usage.sh`

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ
./scripts/check_api_usage.sh remote

# –õ–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
./scripts/check_api_usage.sh local
```

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
- –¢–æ–ø 10 endpoints
- –ê–∫—Ç–∏–≤–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 –∑–∞–ø—Ä–æ—Å–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–µ—Ä—Å–∏—è–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö endpoints –∑–∞ –Ω–µ–¥–µ–ª—é

### 3. –ß–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞–ø—Ä—è–º—É—é

**–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:**
```bash
ssh root@81.163.31.224
mysql -u currency_user -pcurrency_password currency_api
```

**–ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
```sql
SELECT 
    COUNT(*) as total_requests,
    COUNT(DISTINCT device_id) as unique_devices,
    COUNT(DISTINCT endpoint) as unique_endpoints
FROM api_requests 
WHERE DATE(created_at) = CURDATE();
```

#### –¢–æ–ø –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö endpoints
```sql
SELECT 
    endpoint,
    method,
    COUNT(*) as requests_count,
    COUNT(DISTINCT device_id) as devices_count
FROM api_requests 
WHERE DATE(created_at) = CURDATE()
GROUP BY endpoint, method
ORDER BY requests_count DESC
LIMIT 10;
```

#### –ê–∫—Ç–∏–≤–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
```sql
SELECT 
    d.device_id,
    d.platform,
    d.app_version,
    COUNT(ar.id) as requests_count,
    MAX(ar.created_at) as last_request
FROM devices d
LEFT JOIN api_requests ar ON d.id = ar.device_id
WHERE ar.created_at >= DATE_SUB(NOW(), INTERVAL 24 HOUR)
GROUP BY d.id
ORDER BY requests_count DESC;
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ endpoint
```sql
SELECT 
    endpoint,
    COUNT(*) as count,
    COUNT(DISTINCT device_id) as devices,
    MIN(created_at) as first_use,
    MAX(created_at) as last_use
FROM api_requests
WHERE endpoint = '/api/rates'
AND created_at >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY endpoint;
```

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º
```sql
SELECT 
    COALESCE(d.platform, 'Unknown') as platform,
    COUNT(DISTINCT d.id) as devices_count,
    COUNT(ar.id) as requests_count
FROM api_requests ar
LEFT JOIN devices d ON ar.device_id = d.id
WHERE ar.created_at >= DATE_SUB(NOW(), INTERVAL 24 HOUR)
GROUP BY d.platform
ORDER BY requests_count DESC;
```

### 4. –ß–µ—Ä–µ–∑ –ª–æ–≥–∏ Nginx

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:**
```bash
ssh root@81.163.31.224
tail -f /var/log/nginx/conversor.onza.me/access_https.log | grep "/api/"
```

**–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤:**
```bash
# –ü–æ–¥—Å—á–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
grep "/api/" /var/log/nginx/conversor.onza.me/access_https.log | wc -l

# –¢–æ–ø IP –∞–¥—Ä–µ—Å–æ–≤
grep "/api/" /var/log/nginx/conversor.onza.me/access_https.log | awk '{print $1}' | sort | uniq -c | sort -rn | head -10

# –¢–æ–ø endpoints
grep "/api/" /var/log/nginx/conversor.onza.me/access_https.log | awk '{print $7}' | sort | uniq -c | sort -rn | head -10
```

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å

### ‚úÖ –ü—Ä–∏–∑–Ω–∞–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API:

1. **–ó–∞–ø—Ä–æ—Å—ã –≤ —Ç–∞–±–ª–∏—Ü–µ `api_requests`**
   - –ï—Å–ª–∏ –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ - API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

2. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**
   - –¢–∞–±–ª–∏—Ü–∞ `devices` —Å–æ–¥–µ—Ä–∂–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
   - –ü–æ–ª–µ `last_active` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

3. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ endpoints**
   - –ö–∞–∫–∏–µ endpoints –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–∞—â–µ –≤—Å–µ–≥–æ
   - –ö–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã (GET/POST) –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

4. **–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ –≤–µ—Ä—Å–∏–∏**
   - –ö–∞–∫–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç API (iOS/Android)
   - –ö–∞–∫–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∞–∫—Ç–∏–≤–Ω—ã

### üîç –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤–æ–µ API:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ User-Agent**
   ```sql
   SELECT DISTINCT user_agent 
   FROM api_requests 
   WHERE created_at >= DATE_SUB(NOW(), INTERVAL 24 HOUR);
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ device_id**
   - –ù–æ–≤—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `devices`

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ endpoints**
   - –ù–æ–≤—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç `/api/rates`, `/api/convert`
   - –°—Ç–∞—Ä—ã–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –ø—É—Ç–∏

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**
   ```sql
   SELECT app_version, COUNT(*) as count
   FROM devices
   WHERE last_active >= DATE_SUB(NOW(), INTERVAL 7 DAY)
   GROUP BY app_version
   ORDER BY count DESC;
   ```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:

```bash
#!/bin/bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ API –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
ACTIVE=$(mysql -u currency_user -pcurrency_password currency_api -se "
    SELECT COUNT(*) 
    FROM api_requests 
    WHERE created_at >= DATE_SUB(NOW(), INTERVAL 1 HOUR)
")

if [ "$ACTIVE" -eq 0 ]; then
    echo "‚ö†Ô∏è  –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ API –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å!"
    # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
fi
```

### –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

–î–æ–±–∞–≤—å—Ç–µ –≤ cron:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
*/5 * * * * /path/to/check_api_activity.sh
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É** - –º–∏–Ω–∏–º—É–º —Ä–∞–∑ –≤ –¥–µ–Ω—å
2. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
3. **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ endpoints** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ
4. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π** - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ API
5. **–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ—à–∏–±–∫–∞–º–∏** - –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É `error_logs`

